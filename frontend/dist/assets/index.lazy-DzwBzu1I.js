import{ab as P,b as T,I as N,j as e,s as b,x as Q,y as U,B as h,z as B,E as j,H as k,r as w,O as u,a5 as C,a6 as f,a7 as M,J as $,a3 as m,ac as F,ad as I,L as J,M as X,ae as Z,af as W,ag as ee,ah as se,ai as te,X as ae,Y as R,Z as E,_ as A,K as V,a0 as q,aj as ne,ak as le,a9 as oe,aa as re,c as ie}from"./index-Cs80-uD8.js";import{A as L,a as K,C as ce,E as de,u as ue,D as xe,I as he,S as pe,b as me,c as ge,d as je,e as ve,g as fe,h as ye,i as we,j as Ce,k as Ne,l as Se,m as be,n as S,o as ke,p as H,q as Pe,r as _,s as Te,t as Me,v as De,w as Fe,x as Ie,y as Re,T as z,f as Ee}from"./table-B29IU-j6.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=P("CircleStop",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["rect",{x:"9",y:"9",width:"6",height:"6",rx:"1",key:"1ssd4o"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=P("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=P("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Le=T("outline","circle","IconCircle",[["path",{d:"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0",key:"svg-0"}]]);/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ke=T("outline","plus","IconPlus",[["path",{d:"M12 5l0 14",key:"svg-0"}],["path",{d:"M5 12l14 0",key:"svg-1"}]]);/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var He=T("outline","stopwatch","IconStopwatch",[["path",{d:"M5 13a7 7 0 1 0 14 0a7 7 0 0 0 -14 0z",key:"svg-0"}],["path",{d:"M14.5 10.5l-2.5 2.5",key:"svg-1"}],["path",{d:"M17 8l1 -1",key:"svg-2"}],["path",{d:"M14 3h-4",key:"svg-3"}]]);const G=({className:s,fixed:t,children:a,...l})=>{const[o,c]=N.useState(0);return N.useEffect(()=>{const r=()=>{c(document.body.scrollTop||document.documentElement.scrollTop)};return document.addEventListener("scroll",r,{passive:!0}),()=>document.removeEventListener("scroll",r)},[]),e.jsx("header",{className:b("flex h-16 items-center gap-3 bg-background p-4 sm:gap-4",t&&"header-fixed peer/header fixed z-50 w-[inherit] rounded-md",o>10&&t?"shadow":"shadow-none",s),...l,children:a})};G.displayName="Header";const _e=[{value:"0",label:"Inactive",icon:Le},{value:"1",label:"Active",icon:He}];function g({column:s,title:t,className:a}){return s.getCanSort()?e.jsx("div",{className:b("flex items-center space-x-2",a),children:e.jsxs(Q,{children:[e.jsx(U,{asChild:!0,children:e.jsxs(h,{variant:"ghost",size:"sm",className:"-ml-3 h-8 data-[state=open]:bg-accent",children:[e.jsx("span",{children:t}),s.getIsSorted()==="desc"?e.jsx(L,{className:"ml-2 h-4 w-4"}):s.getIsSorted()==="asc"?e.jsx(K,{className:"ml-2 h-4 w-4"}):e.jsx(ce,{className:"ml-2 h-4 w-4"})]})}),e.jsxs(B,{align:"start",children:[e.jsxs(j,{onClick:()=>s.toggleSorting(!1),children:[e.jsx(K,{className:"mr-2 h-3.5 w-3.5 text-muted-foreground/70"}),"Asc"]}),e.jsxs(j,{onClick:()=>s.toggleSorting(!0),children:[e.jsx(L,{className:"mr-2 h-3.5 w-3.5 text-muted-foreground/70"}),"Desc"]}),s.getCanHide()&&e.jsxs(e.Fragment,{children:[e.jsx(k,{}),e.jsxs(j,{onClick:()=>s.toggleVisibility(!1),children:[e.jsx(de,{className:"mr-2 h-3.5 w-3.5 text-muted-foreground/70"}),"Hide"]})]})]})]})}):e.jsx("div",{className:b(a),children:t})}const Y=N.createContext(null);function ze({children:s}){const[t,a]=ue(null),[l,o]=w.useState(null);return e.jsx(Y,{value:{open:t,setOpen:a,currentRow:l,setCurrentRow:o},children:s})}const D=()=>{const s=N.useContext(Y);if(!s)throw new Error("useTasks has to be used within <TasksContext>");return s},Oe=u.object({id:u.any(),title:u.any(),description:u.any(),active:u.any(),yes_votes:u.any(),no_votes:u.any()}),Qe=()=>C({mutationFn:async s=>f.post("/polls/create.php",s)}),Ue=()=>C({mutationFn:async s=>f.post("/polls/update.php",s)}),Be=()=>C({mutationFn:async s=>f.post("/polls/delete.php",s)}),Ge=()=>C({mutationFn:async s=>f.post("/polls/activate.php",s)}),Ye=()=>C({mutationFn:async s=>f.post("/polls/deactivate.php",s)});function $e({row:s}){const t=M(),a=Oe.parse(s.original),{mutate:l}=Ge(),{mutate:o}=Ye(),{setOpen:c,setCurrentRow:r}=D(),i=()=>{l({poll_id:a.id},{onSuccess:()=>{t.invalidateQueries({queryKey:["pollsList"]})},onError:n=>{var d,p;m({title:"Something went wrong",description:((p=(d=n==null?void 0:n.response)==null?void 0:d.data)==null?void 0:p.message)||"An unexpected error occurred",variant:"destructive"})}})},y=()=>{o({poll_id:a.id},{onSuccess:()=>{t.invalidateQueries({queryKey:["pollsList"]})},onError:n=>{var d,p;m({title:"Something went wrong",description:((p=(d=n==null?void 0:n.response)==null?void 0:d.data)==null?void 0:p.message)||"An unexpected error occurred",variant:"destructive"})}})};return e.jsxs(Q,{modal:!1,children:[e.jsx(U,{asChild:!0,children:e.jsx(h,{variant:"ghost",className:"flex h-8 w-8 p-0 data-[state=open]:bg-muted",children:e.jsx(xe,{className:"h-4 w-4"})})}),e.jsxs(B,{align:"end",className:"w-[160px]",children:[a.active==="1"&&e.jsx(e.Fragment,{children:e.jsxs(j,{className:"cursor-pointer",onClick:y,children:[e.jsx(Ae,{className:"text-red-500"}),"End Poll"]})}),a.active==="0"&&e.jsxs(j,{className:"cursor-pointer",onClick:i,children:[e.jsx(Ve,{className:"text-green-500"}),"Activate Poll"]}),e.jsx(k,{}),e.jsxs(j,{className:"cursor-pointer",onClick:()=>{r(a),c("update")},children:[e.jsx(qe,{className:" text-blue-500"}),"Edit"]}),e.jsx(k,{}),e.jsxs(j,{className:"cursor-pointer",onClick:()=>{r(a),c("delete")},children:["Delete",e.jsx($,{children:e.jsx(he,{size:16,className:"text-red-600"})})]})]})]})}const Je=[{accessorKey:"id",header:({column:s})=>e.jsx(g,{column:s,title:"ID"}),cell:({row:s})=>e.jsx("div",{className:"w-[20px]",children:s.original.id}),enableSorting:!1,enableHiding:!1},{accessorKey:"title",header:({column:s})=>e.jsx(g,{column:s,title:"Title"}),cell:({row:s})=>e.jsxs("div",{className:"",children:[e.jsx("span",{className:"truncate font-medium d-block",children:s.getValue("title")}),e.jsx("p",{children:s.original.description})]})},{accessorKey:"active",header:({column:s})=>e.jsx(g,{column:s,title:"Status"}),cell:({row:s})=>{const t=_e.find(a=>{var l;return a.value.toString()===((l=s.getValue("active"))==null?void 0:l.toString())});return console.log("status",t),t?e.jsx("div",{className:"flex w-[100px] items-center",children:e.jsx("span",{className:"flex items-center gap-2",children:e.jsxs(F,{variant:t.value==="1"?"default":"secondary",children:[e.jsx(t.icon,{size:12,className:"mr-2"})," ",t.label]})})}):null}},{accessorKey:"start_date",header:({column:s})=>e.jsx(g,{column:s,title:"Start Date"}),cell:({row:s})=>e.jsx("div",{className:"flex items-center",children:e.jsx("span",{children:e.jsx(I,{value:s.getValue("start_date")})})})},{accessorKey:"end_date",header:({column:s})=>e.jsx(g,{column:s,title:"End Date"}),cell:({row:s})=>e.jsx("div",{className:"flex items-center",children:e.jsx("span",{children:e.jsx(I,{value:s.getValue("end_date")})})})},{accessorKey:"vote_ratio",header:({column:s})=>e.jsx(g,{column:s,title:"Vote Ratio (%)"}),cell:({row:s})=>e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{children:["Yes: ",s.original.yes_votes,e.jsx("span",{className:"fill-grey-900",children:" |"}),"No: ",s.original.no_votes]})})},{accessorKey:"result",header:({column:s})=>e.jsx(g,{column:s,title:"Result"}),cell:({row:s})=>e.jsx("div",{className:"flex items-center",children:e.jsx(F,{variant:`${s.getValue("result")==="Accepted"?"default":"outline"}`,children:s.getValue("result")})})},{id:"actions",cell:({row:s})=>e.jsx($e,{row:s})}];function Xe({table:s}){return e.jsxs("div",{className:"flex items-center justify-between overflow-clip px-2",style:{overflowClipMargin:1},children:[e.jsxs("div",{className:"hidden flex-1 text-sm text-muted-foreground sm:block",children:[s.getFilteredSelectedRowModel().rows.length," of"," ",s.getFilteredRowModel().rows.length," row(s) selected."]}),e.jsxs("div",{className:"flex items-center sm:space-x-6 lg:space-x-8",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("p",{className:"hidden text-sm font-medium sm:block",children:"Rows per page"}),e.jsxs(pe,{value:`${s.getState().pagination.pageSize}`,onValueChange:t=>{s.setPageSize(Number(t))},children:[e.jsx(me,{className:"h-8 w-[70px]",children:e.jsx(ge,{placeholder:s.getState().pagination.pageSize})}),e.jsx(je,{side:"top",children:[10,20,30,40,50].map(t=>e.jsx(ve,{value:`${t}`,children:t},t))})]})]}),e.jsxs("div",{className:"flex w-[100px] items-center justify-center text-sm font-medium",children:["Page ",s.getState().pagination.pageIndex+1," of"," ",s.getPageCount()]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(h,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>s.setPageIndex(0),disabled:!s.getCanPreviousPage(),children:[e.jsx("span",{className:"sr-only",children:"Go to first page"}),e.jsx(fe,{className:"h-4 w-4"})]}),e.jsxs(h,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>s.previousPage(),disabled:!s.getCanPreviousPage(),children:[e.jsx("span",{className:"sr-only",children:"Go to previous page"}),e.jsx(ye,{className:"h-4 w-4"})]}),e.jsxs(h,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>s.nextPage(),disabled:!s.getCanNextPage(),children:[e.jsx("span",{className:"sr-only",children:"Go to next page"}),e.jsx(we,{className:"h-4 w-4"})]}),e.jsxs(h,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>s.setPageIndex(s.getPageCount()-1),disabled:!s.getCanNextPage(),children:[e.jsx("span",{className:"sr-only",children:"Go to last page"}),e.jsx(Ce,{className:"h-4 w-4"})]})]})]})]})}function Ze({columns:s,data:t}){var p;const[a,l]=w.useState({}),[o,c]=w.useState({}),[r,i]=w.useState([]),[y,n]=w.useState([]),d=Ne({data:t,columns:s,state:{sorting:y,columnVisibility:o,rowSelection:a,columnFilters:r},enableRowSelection:!0,onRowSelectionChange:l,onSortingChange:n,onColumnFiltersChange:i,onColumnVisibilityChange:c,getCoreRowModel:Re(),getFilteredRowModel:Ie(),getPaginationRowModel:Fe(),getSortedRowModel:De(),getFacetedRowModel:Me(),getFacetedUniqueValues:Te()});return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"rounded-md border",children:e.jsxs(Se,{children:[e.jsx(be,{children:d.getHeaderGroups().map(v=>e.jsx(S,{children:v.headers.map(x=>e.jsx(ke,{colSpan:x.colSpan,children:x.isPlaceholder?null:H(x.column.columnDef.header,x.getContext())},x.id))},v.id))}),e.jsx(Pe,{children:(p=d.getRowModel().rows)!=null&&p.length?d.getRowModel().rows.map(v=>e.jsx(S,{"data-state":v.getIsSelected()&&"selected",children:v.getVisibleCells().map(x=>e.jsx(_,{children:H(x.column.columnDef.cell,x.getContext())},x.id))},v.id)):e.jsx(S,{children:e.jsx(_,{colSpan:s.length,className:"h-24 text-center",children:"No results."})})})]})}),e.jsx(Xe,{table:d})]})}const We=u.object({title:u.string().min(1,"Title is required."),description:u.string()});function O({open:s,onOpenChange:t,currentRow:a}){const l=M(),o=!!a,{mutate:c}=Qe(),{mutate:r}=Ue(),i=J({resolver:X(We),defaultValues:a}),y=n=>{if(o){r({...n,id:a==null?void 0:a.id},{onSuccess:()=>{m({title:"Poll updated successfully"}),t(!1),i.reset(),l.invalidateQueries({queryKey:["pollsList"]})},onError:()=>{m({title:"Something went wrong",description:"Could not update the poll. Try again later.",variant:"destructive"})}});return}c(n,{onSuccess:()=>{m({title:"Poll created successfully"}),t(!1),i.reset(),l.invalidateQueries({queryKey:["pollsList"]})},onError:()=>{m({title:"Something went wrong",description:"Could not create the poll. Try again later.",variant:"destructive"})}})};return e.jsx(Z,{open:s,onOpenChange:n=>{t(n),i.reset()},children:e.jsxs(W,{className:"flex flex-col",children:[e.jsxs(ee,{className:"text-left",children:[e.jsxs(se,{children:[o?"Update":"Create"," Poll"]}),e.jsxs(te,{children:[o?"Update the poll by providing necessary info.":"Add a new poll by providing necessary info.","Click save when you're done."]})]}),e.jsx(ae,{...i,children:e.jsxs("form",{id:"tasks-form",onSubmit:i.handleSubmit(y),className:"flex-1 space-y-5",children:[e.jsx(R,{control:i.control,name:"title",render:({field:n})=>e.jsxs(E,{className:"space-y-1",children:[e.jsx(A,{children:"Title"}),e.jsx(V,{children:e.jsx(z,{...n,placeholder:"Enter subject in English",rows:2})}),e.jsx(q,{})]})}),e.jsx(R,{control:i.control,name:"description",render:({field:n})=>e.jsxs(E,{className:"space-y-1",children:[e.jsx(A,{children:"Description"}),e.jsx(V,{children:e.jsx(z,{...n,placeholder:"Add description here",rows:10})}),e.jsx(q,{})]})})]})}),e.jsxs(ne,{className:"gap-2",children:[e.jsx(le,{asChild:!0,children:e.jsx(h,{variant:"outline",children:"Close"})}),e.jsx(h,{form:"tasks-form",type:"submit",children:"Save changes"})]})]})})}function es(){const{open:s,setOpen:t,currentRow:a,setCurrentRow:l}=D(),{mutate:o}=Be(),c=M(),r=()=>{o({id:a==null?void 0:a.id},{onSuccess:()=>{m({title:"Poll updated successfully"}),t(null),l(null),c.invalidateQueries({queryKey:["pollsList"]})},onError:()=>{m({title:"Something went wrong",description:"Could not update the poll. Try again later.",variant:"destructive"})}})};return e.jsxs(e.Fragment,{children:[e.jsx(O,{open:s==="create",onOpenChange:()=>t("create")},"task-create"),a&&e.jsxs(e.Fragment,{children:[e.jsx(O,{open:s==="update",onOpenChange:()=>{t("update"),setTimeout(()=>{l(null)},500)},currentRow:a},"task-update"),e.jsx(Ee,{destructive:!0,open:s==="delete",onOpenChange:()=>{t("delete"),setTimeout(()=>{l(null)},500)},handleConfirm:r,className:"max-w-md",title:"Delete this poll ?",desc:e.jsxs(e.Fragment,{children:["You are about to delete ",e.jsx("strong",{children:a.title}),e.jsx("br",{}),"This action cannot be undone."]}),confirmText:"Delete"},"task-delete")]})]})}function ss(){const{setOpen:s}=D();return e.jsx("div",{className:"flex gap-2",children:e.jsxs(h,{className:"space-x-1",onClick:()=>s("create"),children:[e.jsx("span",{children:"Create"})," ",e.jsx(Ke,{size:18})]})})}const ts=()=>oe({queryKey:["pollsList"],queryFn:async()=>(await f.get("/polls/list.php")).data});function as(){const{data:s,isLoading:t}=ts();return e.jsxs(ze,{children:[e.jsx(G,{fixed:!0}),e.jsxs(re,{children:[e.jsxs("div",{className:"mb-2 flex flex-wrap items-center justify-between gap-x-4 space-y-2",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Polls"}),e.jsx("p",{className:"text-muted-foreground",children:"Create and manage your polls here."})]}),e.jsx(ss,{})]}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-x-12 lg:space-y-0",children:s&&(s==null?void 0:s.data)&&e.jsx(Ze,{data:s.data,columns:Je})})]}),e.jsx(es,{})]})}const os=ie("/_authenticated/polls/")({component:as});export{os as Route};
